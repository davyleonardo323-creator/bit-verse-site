<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NEON WARFARE — FPS Sci-Fi (Single-file Demo)</title>
<meta name="description" content="Neon Warfare — jogo de tiro sci-fi. Demo single-file com painel admin client-side." />
<style>
/* ===========================
   CSS: visual gamer preto/roxo
   =========================== */

/* Variables */
:root{
  --bg:#07060a;
  --panel:#0f0f17;
  --accent:#8b5cf6;
  --accent-2:#7c3aed;
  --muted:#9aa3b2;
  --glass: rgba(255,255,255,0.03);
  --glass-2: rgba(124,58,237,0.06);
  --radius:14px;
  --text:#e6eef6;
  --card-grad: linear-gradient(135deg, rgba(124,58,237,0.09), rgba(139,92,246,0.04));
  font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, Arial;
  color-scheme: dark;
}

/* Reset */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background: radial-gradient(ellipse at top left, rgba(124,58,237,0.06), transparent 18%),
              linear-gradient(180deg,#050507 0%, #08070a 100%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  overflow-y:auto;
  -webkit-tap-highlight-color:transparent;
}

/* Particles canvas sits behind content */
#particles{position:fixed; inset:0; z-index:0; pointer-events:none}

/* Layout */
.container{position:relative; z-index:2; max-width:1200px; margin:28px auto; padding:18px}
.header{
  display:flex; align-items:center; justify-content:space-between; gap:16px;
  padding:12px 6px; margin-bottom:18px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.0));
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.02);
  box-shadow: 0 6px 30px rgba(2,6,23,0.6);
}

/* Brand */
.brand{display:flex; align-items:center; gap:12px}
.brand .logo{
  width:56px; height:56px; border-radius:10px; background:linear-gradient(135deg,var(--accent),var(--accent-2));
  display:flex; align-items:center; justify-content:center; font-weight:700; font-size:18px;
  box-shadow: 0 10px 30px rgba(124,58,237,0.14);
}

/* Hamburger accessible */
.hamburger{background:transparent;border:0;padding:8px; cursor:pointer; display:flex; flex-direction:column; gap:4px}
.hamburger:focus{outline:3px solid rgba(139,92,246,0.18); border-radius:8px}
.hamburger .bar{width:26px;height:3px;background:linear-gradient(90deg,var(--accent),var(--accent-2));border-radius:3px;}

/* Menu */
.menu{display:flex; gap:12px; align-items:center; list-style:none; margin:0; padding:0}
.menu button, .menu a{background:transparent;border:0;color:var(--muted); padding:8px 10px;border-radius:8px; cursor:pointer; text-decoration:none}
.menu a:hover, .menu button:hover{color:var(--text); background:rgba(255,255,255,0.02); transform:translateY(-3px); transition:all .16s}

/* Hero */
.hero{display:grid; grid-template-columns:1fr 420px; gap:22px; align-items:center; padding:26px; border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent); box-shadow: 0 12px 40px rgba(2,6,23,0.6)}
.title{font-size:44px; margin:0 0 6px 0; letter-spacing:2px}
.subtitle{color:var(--muted); margin:0 0 12px 0}

/* Buttons */
.btn{display:inline-flex; align-items:center; gap:10px; padding:12px 16px; border-radius:12px; cursor:pointer; text-decoration:none; font-weight:600}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:white; box-shadow: 0 10px 30px rgba(124,58,237,0.14)}
.btn.ghost{border:1px solid rgba(255,255,255,0.06); color:var(--muted); background:transparent}

/* Counters */
.counters{display:flex; gap:12px; margin-top:16px}
.counter{background:var(--glass); padding:10px 12px; border-radius:10px; min-width:110px; text-align:center}
.counter .num{font-size:20px; font-weight:800; color:var(--accent)}
.counter .lbl{font-size:12px;color:var(--muted)}

/* Poster */
.poster{background:var(--card-grad); padding:12px; border-radius:12px; display:flex; align-items:center; justify-content:center; min-height:260px}
.poster img{width:100%;height:100%;object-fit:cover;border-radius:8px; box-shadow: 0 18px 50px rgba(0,0,0,0.6); transition:transform .6s cubic-bezier(.2,.9,.2,1)}
.poster img:hover{transform:translateY(-8px) scale(1.02)}

/* Sections */
.section{margin-top:18px; padding:18px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.0)); border: 1px solid rgba(255,255,255,0.02)}
.section h3{margin-top:0}

/* Cards grid */
.cards{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px}
.card{background:var(--glass); padding:14px; border-radius:12px; transition:transform .18s ease, box-shadow .18s ease; cursor:default}
.card:hover{transform:translateY(-6px); box-shadow:0 12px 40px rgba(124,58,237,0.08)}
.card h4{margin:0 0 8px 0}
.card p{margin:0;color:var(--muted)}

/* Gallery */
.gallery{display:flex; gap:10px; overflow-x:auto; padding-bottom:6px}
.thumb{width:200px; height:120px; border-radius:10px; flex:0 0 auto; overflow:hidden; position:relative}
.thumb img{width:100%;height:100%;object-fit:cover; display:block}

/* Trailer */
.video-wrap{display:flex; gap:12px; align-items:center; justify-content:center}
.video-wrap iframe, .video-wrap video{width:100%; max-width:820px; height:460px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); background:#000}

/* Countdown */
.countdown{display:flex; gap:12px; justify-content:center; margin-top:12px}
.countdown > div{background:var(--glass); padding:14px 18px; border-radius:10px; text-align:center}
.countdown span{display:block; font-size:22px; font-weight:800; color:var(--accent)}
.countdown small{color:var(--muted)}

/* Footer */
.footer{margin-top:20px; color:var(--muted); text-align:center; font-size:13px}

/* Modal (Admin login / editor) */
.modal-backdrop{position:fixed; inset:0; background:linear-gradient(90deg, rgba(2,6,23,0.6), rgba(0,0,0,0.6)); display:flex; align-items:center; justify-content:center; z-index:60}
.modal{background:linear-gradient(180deg, rgba(10,10,12,1), rgba(16,12,20,1)); padding:18px; border-radius:12px; width:min(920px,96%); max-height:88vh; overflow:auto; border:1px solid rgba(255,255,255,0.03)}
.modal h4{margin-top:0}
.form-row{display:flex; gap:8px; margin-bottom:8px}
.form-row input[type="text"], .form-row input[type="password"], textarea, select{flex:1; padding:10px 12px; border-radius:8px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); color:var(--text)}
.small{font-size:13px;color:var(--muted)}

/* Admin edit markers (visible when logged in) */
.edit-badge{display:inline-block;background:rgba(124,58,237,0.14); color:var(--accent); padding:4px 8px; border-radius:999px; font-size:12px; margin-left:8px}

/* Responsive */
@media (max-width:920px){
  .hero{grid-template-columns:1fr; padding:18px}
  .poster img{height:320px}
  .video-wrap iframe, .video-wrap video{height:260px}
}

/* Accessibility helper screen-reader only */
.sr-only{position:absolute!important; width:1px!important; height:1px!important; padding:0!important; margin:-1px!important; overflow:hidden!important; clip:rect(0,0,0,0)!important; white-space:nowrap!important; border:0!important}
</style>
</head>
<body>
<!-- Particles canvas -->
<canvas id="particles" aria-hidden="true"></canvas>

<div class="container" id="root">
  <header class="header" role="banner">
    <div class="brand" aria-hidden="false">
      <div class="logo" id="logo-text">NW</div>
      <div>
        <div style="font-weight:700">Neon Warfare</div>
        <div style="font-size:12px;color:var(--muted)">FPS Sci‑Fi — Demo</div>
      </div>
    </div>

    <nav role="navigation" aria-label="Navegação principal">
      <button class="hamburger" id="hambtn" aria-controls="main-menu" aria-expanded="false" aria-label="Abrir menu">
        <span class="bar"></span><span class="bar"></span><span class="bar"></span>
      </button>

      <ul id="main-menu" class="menu" role="menubar" style="display:none">
        <li role="none"><a role="menuitem" href="#home">Home</a></li>
        <li role="none"><a role="menuitem" href="#features">Recursos</a></li>
        <li role="none"><a role="menuitem" href="#screenshots">Imagens</a></li>
        <li role="none"><a role="menuitem" href="#trailer">Trailer</a></li>
        <li role="none"><a role="menuitem" href="#launch">Lançamento</a></li>
        <li role="none"><button id="open-admin" role="menuitem" aria-haspopup="dialog">Painel Admin</button></li>
      </ul>
    </nav>
  </header>

  <main id="main" role="main">
    <!-- HERO -->
    <section id="home" class="hero" aria-labelledby="title">
      <div>
        <h1 id="title" class="title" tabindex="0">NEON WARFARE<span id="edit-title-badge" class="edit-badge" style="display:none">Edit</span></h1>
        <p id="subtitle" class="subtitle">FPS tático futurista — domine os neon-ruins com arsenal high‑tech.</p>

        <div style="display:flex; gap:12px; align-items:center; margin-top:12px">
          <a id="preorder" class="btn primary" href="#" role="button">Pré-venda</a>
          <a class="btn ghost" href="#trailer">Assista ao Trailer</a>
        </div>

        <div class="counters" style="margin-top:18px">
          <div class="counter">
            <div class="num" id="counter-players">1250</div>
            <div class="lbl">Beta Testers</div>
          </div>
          <div class="counter">
            <div class="num" id="counter-followers">5320</div>
            <div class="lbl">Seguidores</div>
          </div>
          <div class="counter">
            <div class="num" id="counter-months">3</div>
            <div class="lbl">Meses até lançamento</div>
          </div>
        </div>
      </div>

      <div class="poster" aria-hidden="false">
        <!-- placeholder poster as inline SVG; admin pode substituir com upload -->
        <img id="poster" alt="Poster do jogo" src="" />
      </div>
    </section>

    <!-- Features -->
    <section id="features" class="section" aria-labelledby="features-title">
      <h3 id="features-title">Recursos <span id="edit-features-badge" class="edit-badge" style="display:none">Edit</span></h3>
      <div class="cards" id="features-cards">
        <!-- cards populated by JS -->
      </div>
    </section>

    <!-- Screenshots -->
    <section id="screenshots" class="section" aria-labelledby="screens-title">
      <h3 id="screens-title">Previews</h3>
      <div class="gallery" id="gallery">
        <!-- thumbs -->
      </div>
    </section>

    <!-- Trailer -->
    <section id="trailer" class="section" aria-labelledby="trailer-title">
      <h3 id="trailer-title">Trailer</h3>
      <div class="video-wrap" id="video-wrap">
        <!-- will try videoUrl else embed youtube placeholder -->
      </div>
    </section>

    <!-- Launch -->
    <section id="launch" class="section" aria-labelledby="launch-title">
      <h3 id="launch-title">Lançamento</h3>
      <div class="countdown" id="countdown">
        <div><span id="days">0</span><small>dias</small></div>
        <div><span id="hours">0</span><small>horas</small></div>
        <div><span id="minutes">0</span><small>min</small></div>
        <div><span id="seconds">0</span><small>seg</small></div>
      </div>
    </section>

    <footer class="footer">
      <div>© <span id="year"></span> Neon Warfare — Prototype</div>
      <div class="small">Painel admin client-side (apenas demo).</div>
    </footer>
  </main>
</div>

<!-- ADMIN modal / editor (hidden by default) -->
<div id="admin-modal" style="display:none" aria-hidden="true">
  <div class="modal-backdrop" id="admin-backdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="admin-title">
      <button id="close-admin-top" style="float:right;background:transparent;border:0;color:var(--muted);font-size:22px" aria-label="Fechar painel">&times;</button>
      <h4 id="admin-title">Painel Admin — Neon Warfare (Demo)</h4>

      <!-- LOGIN area (shows when not logged) -->
      <div id="login-area">
        <p class="small">Faça login para editar o site. (Demo: <strong>leonardoadmearthur</strong> / <strong>11122231</strong>)</p>
        <form id="login-form" onsubmit="return false">
          <div class="form-row">
            <label for="adm-user" class="small" style="min-width:90px">Usuário</label>
            <input id="adm-user" type="text" aria-label="Usuário admin" required />
          </div>
          <div class="form-row">
            <label for="adm-pass" class="small" style="min-width:90px">Senha</label>
            <input id="adm-pass" type="password" aria-label="Senha admin" required />
          </div>
          <div style="display:flex; gap:8px; margin-top:8px">
            <button id="login-btn" class="btn primary">Entrar</button>
            <button id="login-cancel" class="btn ghost" type="button">Cancelar</button>
          </div>
          <p id="login-error" class="small" style="color:#ff7676"></p>
        </form>
      </div>

      <!-- EDITOR area (shows when logged) -->
      <div id="editor-area" style="display:none">
        <p class="small">Edite o conteúdo abaixo — alterações aplicadas imediatamente e salvas no <code>localStorage</code>.</p>

        <!-- Site texts -->
        <details open>
          <summary>Textos</summary>
          <div style="padding:8px 0">
            <label class="small">Título principal</label>
            <input type="text" id="edit-title" />
            <label class="small">Subtítulo</label>
            <input type="text" id="edit-subtitle" />
            <label class="small">Botão Pré-venda (texto)</label>
            <input type="text" id="edit-preorder" />
          </div>
        </details>

        <!-- Counters -->
        <details>
          <summary>Contadores</summary>
          <div style="padding:8px 0">
            <label class="small">Beta Testers</label>
            <input type="number" id="edit-players" min="0" />
            <label class="small">Seguidores</label>
            <input type="number" id="edit-followers" min="0" />
            <label class="small">Meses até lançamento</label>
            <input type="number" id="edit-months" min="0" />
          </div>
        </details>

        <!-- Banners / poster -->
        <details>
          <summary>Imagens / Trailer</summary>
          <div style="padding:8px 0">
            <label class="small">Poster (upload)</label>
            <input type="file" id="poster-upload" accept="image/*" />
            <div id="poster-preview" style="margin-top:8px"></div>

            <label class="small">Imagens da galeria (upload múltiplo)</label>
            <input type="file" id="gallery-upload" accept="image/*" multiple />
            <div id="gallery-preview" style="display:flex;gap:8px;margin-top:8px;overflow:auto;"></div>

            <label class="small">Trailer (YouTube URL ou embed)</label>
            <input type="text" id="edit-trailer" placeholder="https://www.youtube.com/watch?v=..." />
          </div>
        </details>

        <!-- Appearance -->
        <details>
          <summary>Aparência</summary>
          <div style="padding:8px 0">
            <label class="small">Cor Principal (hex)</label>
            <input type="text" id="edit-accent" placeholder="#8b5cf6" />
            <label class="small">Mostrar partículas no fundo</label>
            <select id="edit-particles"><option value="1">Sim</option><option value="0">Não</option></select>
          </div>
        </details>

        <!-- Countdown -->
        <details>
          <summary>Contagem regressiva / Lançamento</summary>
          <div style="padding:8px 0">
            <label class="small">Data e hora do lançamento (UTC)</label>
            <input type="datetime-local" id="edit-launch" />
            <div class="small" style="margin-top:6px">Use UTC; as diferenças de fuso serão calculadas no cliente.</div>
          </div>
        </details>

        <div style="display:flex; gap:10px; margin-top:12px">
          <button id="save-btn" class="btn primary">Salvar agora</button>
          <button id="reset-btn" class="btn ghost" type="button">Restaurar demo</button>
          <button id="logout-btn" class="btn" type="button">Sair</button>
        </div>
        <p class="small" style="margin-top:10px; color:var(--muted)">
          Observação: autenticação é totalmente client-side — não segura para produção. Veja README para instruções de segurança.
        </p>
      </div>

    </div>
  </div>
</div>

<script>
/* ======================
   JavaScript: comportamento
   ====================== */

/* ----------------------
   Helper / Inicialização
   ---------------------- */

// Demo initial data (usado caso não exista localStorage)
const DEMO = {
  title: "NEON WARFARE",
  subtitle: "FPS tático futurista — domine a cidade neon.",
  preorderText: "Pré-venda",
  counters: { players: 1250, followers: 5320, months: 3 },
  posterData: null, // base64 image data
  gallery: [], // array of base64
  trailer: "https://www.youtube.com/embed/dQw4w9WgXcQ", // placeholder
  accent: "#8b5cf6",
  particles: true,
  launchUTC: null // ISO string
};

const STORAGE_KEY = "neonw_demo_v1";

/* load saved or fallback */
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return JSON.parse(JSON.stringify(DEMO));
    return Object.assign(JSON.parse(JSON.stringify(DEMO)), JSON.parse(raw));
  }catch(e){ console.warn("loadState error", e); return JSON.parse(JSON.stringify(DEMO)); }
}

/* safe save */
function saveState(state){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* global state */
let SITE = loadState();

/* Apply accent color to CSS variables */
function applyAccent(hex){
  if(!hex) return;
  document.documentElement.style.setProperty('--accent', hex);
  // minor darker variation:
  try{
    const dark = shadeColor(hex, -12);
    document.documentElement.style.setProperty('--accent-2', dark);
  }catch(e){}
}

/* shade helper */
function shadeColor(color, percent) {
    // expects hex like #rrggbb
    let R=parseInt(color.substring(1,3),16);
    let G=parseInt(color.substring(3,5),16);
    let B=parseInt(color.substring(5,7),16);
    R = parseInt(R * (100+percent) / 100);
    G = parseInt(G * (100+percent) / 100);
    B = parseInt(B * (100+percent) / 100);
    R = (R<255)?R:255; G=(G<255)?G:255; B=(B<255)?B:255;
    let RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
    let GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
    let BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));
    return "#"+RR+GG+BB;
}

/* ----------------------
   UI render functions
   ---------------------- */

function renderAll(){
  document.getElementById('title').textContent = SITE.title;
  document.getElementById('subtitle').textContent = SITE.subtitle;
  document.getElementById('preorder').textContent = SITE.preorderText || 'Pré-venda';
  document.getElementById('counter-players').textContent = SITE.counters.players;
  document.getElementById('counter-followers').textContent = SITE.counters.followers;
  document.getElementById('counter-months').textContent = SITE.counters.months;
  // poster
  const poster = document.getElementById('poster');
  if(SITE.posterData){
    poster.src = SITE.posterData;
  } else {
    // fallback svg poster as dataURL
    poster.src = makePosterSVG(SITE.title, SITE.subtitle);
  }
  // features cards (static demo cards, editable later if you'd like)
  renderFeatures();
  // gallery
  renderGallery();
  // trailer / video
  renderTrailer();
  // accent
  applyAccent(SITE.accent);
  // countdown initial compute
  computeCountdown();
  // particles toggle
  if(SITE.particles) startParticles(); else stopParticles();
  // update year
  document.getElementById('year').textContent = new Date().getFullYear();
}

function renderFeatures(){
  const features = [
    {title:'Ação Tática', desc:'Combates rápidos, cobertura e gadgets furtivos.'},
    {title:'Armas Futuristas', desc:'Personalização profunda com mods neon.'},
    {title:'Mapas Dinâmicos', desc:'Ambientes que mudam entre rodadas.'},
    {title:'Competitivo', desc:'Ranked, seasons e recompensas.'},
  ];
  const root = document.getElementById('features-cards');
  root.innerHTML = '';
  features.forEach(f=>{
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `<h4>${f.title}</h4><p>${f.desc}</p>`;
    root.appendChild(el);
  });
}

function renderGallery(){
  const g = document.getElementById('gallery');
  g.innerHTML = '';
  (SITE.gallery || []).forEach(d=>{
    const div = document.createElement('div'); div.className='thumb';
    const img = document.createElement('img'); img.src = d;
    div.appendChild(img); g.appendChild(div);
  });
}

/* render trailer: if SITE.trailer looks like an embed, use iframe; otherwise, try <video> (not included in single-file) */
function renderTrailer(){
  const wrap = document.getElementById('video-wrap');
  wrap.innerHTML = '';
  if(!SITE.trailer) {
    wrap.innerHTML = '<div class="small">Nenhum trailer configurado.</div>';
    return;
  }
  // detect youtube embed or url
  if(SITE.trailer.includes('youtube.com') || SITE.trailer.includes('youtu.be') || SITE.trailer.startsWith('https://www.youtube.com/embed/')){
    let src = SITE.trailer;
    // if user pasted watch?v=... convert to embed
    if(src.includes('watch?v=')) src = src.replace('watch?v=', 'embed/');
    if(src.includes('youtu.be/')) src = src.replace('youtu.be/', 'www.youtube.com/embed/');
    const iframe = document.createElement('iframe');
    iframe.src = src;
    iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
    iframe.title = "Trailer de Neon Warfare";
    iframe.setAttribute('aria-label','Trailer do jogo');
    wrap.appendChild(iframe);
  } else {
    // fallback: show link
    const a = document.createElement('a');
    a.href = SITE.trailer; a.textContent = 'Abrir trailer'; a.target = '_blank'; a.rel='noopener';
    a.className = 'btn ghost';
    wrap.appendChild(a);
  }
}

/* poster fallback generator (simple SVG data URL) */
function makePosterSVG(title, subtitle){
  const bg = SITE.accent || '#8b5cf6';
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='1600'>
    <defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='${bg}'/><stop offset='1' stop-color='#1f1547'/></linearGradient></defs>
    <rect width='100%' height='100%' fill='url(#g)'/>
    <text x='50%' y='40%' font-family='Inter,Arial' font-size='80' fill='white' text-anchor='middle' font-weight='800'>${escapeXml(title)}</text>
    <text x='50%' y='48%' font-family='Inter,Arial' font-size='28' fill='rgba(255,255,255,0.8)' text-anchor='middle'>${escapeXml(subtitle)}</text>
    <rect x='80' y='1100' width='1040' height='200' rx='18' fill='rgba(0,0,0,0.25)'/>
    <text x='1000' y='1230' font-size='20' fill='rgba(255,255,255,0.75)' text-anchor='end'>NEON WARFARE</text>
  </svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}
function escapeXml(s){ return String(s).replace(/[&<>'"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&apos;' }[c])); }

/* ----------------------
   Countdown logic
   ---------------------- */
let countdownTimer = null;
function computeCountdown(){
  if(!SITE.launchUTC){
    // default: months counter already displayed; clear numbers
    document.getElementById('days').textContent='0';
    document.getElementById('hours').textContent='0';
    document.getElementById('minutes').textContent='0';
    document.getElementById('seconds').textContent='0';
    return;
  }
  if(countdownTimer) clearInterval(countdownTimer);
  function tick(){
    const now = new Date();
    const target = new Date(SITE.launchUTC);
    const diff = target - now;
    if(diff<=0){
      document.getElementById('days').textContent='0';
      document.getElementById('hours').textContent='0';
      document.getElementById('minutes').textContent='0';
      document.getElementById('seconds').textContent='0';
      clearInterval(countdownTimer);
      return;
    }
    const sec = Math.floor(diff/1000)%60;
    const min = Math.floor(diff/1000/60)%60;
    const hrs = Math.floor(diff/1000/60/60)%24;
    const days = Math.floor(diff/1000/60/60/24);
    document.getElementById('days').textContent = days;
    document.getElementById('hours').textContent = hrs;
    document.getElementById('minutes').textContent = min;
    document.getElementById('seconds').textContent = sec;
  }
  tick();
  countdownTimer = setInterval(tick, 1000);
}

/* ----------------------
   Admin authentication (client-side only)
   ---------------------- */

const ADMIN_CRED = { user: 'leonardoadmearthur', pass: '11122231' };
let isLogged = false;

function openAdminModal(){
  document.getElementById('admin-modal').style.display='block';
  document.getElementById('admin-modal').setAttribute('aria-hidden','false');
  // if logged show editor else login
  if(isLogged){ showEditor(); } else { showLogin(); }
  // trap focus: focus first visible input
  setTimeout(()=>{ const f = document.querySelector('#admin-modal input:not([type=hidden])'); if(f) f.focus(); },80);
}

function closeAdminModal(){
  document.getElementById('admin-modal').style.display='none';
  document.getElementById('admin-modal').setAttribute('aria-hidden','true');
}

/* show login form */
function showLogin(){
  document.getElementById('login-area').style.display='block';
  document.getElementById('editor-area').style.display='none';
}

/* show editor area */
function showEditor(){
  document.getElementById('login-area').style.display='none';
  document.getElementById('editor-area').style.display='block';
  fillEditorWithState();
}

/* try login */
function tryLogin(user, pass){
  const errEl = document.getElementById('login-error');
  if(user === ADMIN_CRED.user && pass === ADMIN_CRED.pass){
    isLogged = true;
    errEl.textContent = '';
    showEditor();
    // mark logged token (client-only)
    sessionStorage.setItem('nw_authed', '1');
    // show small badges for editable sections
    document.querySelectorAll('.edit-badge').forEach(b=>b.style.display='inline-block');
    return true;
  } else {
    errEl.textContent = 'Credenciais incorretas.';
    return false;
  }
}

function tryLogout(){
  isLogged = false;
  sessionStorage.removeItem('nw_authed');
  showLogin();
  document.querySelectorAll('.edit-badge').forEach(b=>b.style.display='none');
}

/* ----------------------
   Editor <-> state synchronization
   ---------------------- */

function fillEditorWithState(){
  document.getElementById('edit-title').value = SITE.title;
  document.getElementById('edit-subtitle').value = SITE.subtitle;
  document.getElementById('edit-preorder').value = SITE.preorderText;
  document.getElementById('edit-players').value = SITE.counters.players;
  document.getElementById('edit-followers').value = SITE.counters.followers;
  document.getElementById('edit-months').value = SITE.counters.months;
  document.getElementById('edit-trailer').value = SITE.trailer || '';
  document.getElementById('edit-accent').value = SITE.accent || '#8b5cf6';
  document.getElementById('edit-particles').value = SITE.particles ? '1':'0';
  document.getElementById('edit-launch').value = SITE.launchUTC ? new Date(SITE.launchUTC).toISOString().slice(0,16) : '';
  // poster preview
  const pp = document.getElementById('poster-preview'); pp.innerHTML='';
  const img = document.createElement('img'); img.style.maxWidth='180px'; img.style.borderRadius='8px';
  img.src = SITE.posterData || makePosterSVG(SITE.title, SITE.subtitle);
  pp.appendChild(img);
  // gallery preview
  const gp = document.getElementById('gallery-preview'); gp.innerHTML='';
  (SITE.gallery||[]).forEach(d=>{
    const i = document.createElement('img'); i.src=d; i.style.width='110px'; i.style.height='70px'; i.style.objectFit='cover'; i.style.borderRadius='6px';
    gp.appendChild(i);
  });
}

/* Install editor event listeners */
function attachEditorEvents(){
  // text edits
  document.getElementById('edit-title').addEventListener('input', e=>{
    SITE.title = e.target.value; renderAll();
  });
  document.getElementById('edit-subtitle').addEventListener('input', e=>{
    SITE.subtitle = e.target.value; renderAll();
  });
  document.getElementById('edit-preorder').addEventListener('input', e=>{
    SITE.preorderText = e.target.value; renderAll();
  });
  // counters
  document.getElementById('edit-players').addEventListener('input', e=>{
    SITE.counters.players = Number(e.target.value || 0); renderAll();
  });
  document.getElementById('edit-followers').addEventListener('input', e=>{
    SITE.counters.followers = Number(e.target.value || 0); renderAll();
  });
  document.getElementById('edit-months').addEventListener('input', e=>{
    SITE.counters.months = Number(e.target.value || 0); renderAll();
  });
  // trailer
  document.getElementById('edit-trailer').addEventListener('change', e=>{
    SITE.trailer = e.target.value; renderAll();
  });
  // accent
  document.getElementById('edit-accent').addEventListener('change', e=>{
    SITE.accent = e.target.value; applyAccent(SITE.accent); renderAll();
  });
  document.getElementById('edit-particles').addEventListener('change', e=>{
    SITE.particles = e.target.value === '1'; renderAll();
  });
  // launch
  document.getElementById('edit-launch').addEventListener('change', e=>{
    const v = e.target.value;
    SITE.launchUTC = v ? new Date(v).toISOString() : null;
    computeCountdown();
  });

  // poster upload
  document.getElementById('poster-upload').addEventListener('change', async e=>{
    const file = e.target.files[0];
    if(!file) return;
    const data = await fileToDataURL(file);
    SITE.posterData = data;
    saveState(SITE);
    fillEditorWithState();
    renderAll();
  });

  // gallery upload (multiple)
  document.getElementById('gallery-upload').addEventListener('change', async e=>{
    const files = Array.from(e.target.files || []);
    for(const f of files){
      const d = await fileToDataURL(f);
      SITE.gallery.push(d);
    }
    saveState(SITE);
    fillEditorWithState();
    renderAll();
  });

  // buttons
  document.getElementById('save-btn').addEventListener('click', ()=>{
    saveState(SITE);
    alert('Salvo no localStorage.');
  });
  document.getElementById('reset-btn').addEventListener('click', ()=>{
    if(confirm('Restaurar dados de demo? Isso sobrescreverá alterações locais.')) {
      localStorage.removeItem(STORAGE_KEY);
      SITE = loadState();
      fillEditorWithState();
      renderAll();
    }
  });
  document.getElementById('logout-btn').addEventListener('click', ()=>{
    tryLogout();
  });
}

/* file -> dataURL helper */
function fileToDataURL(file){
  return new Promise((resolve,reject)=>{
    const r = new FileReader();
    r.onload = ()=>resolve(r.result);
    r.onerror = reject;
    r.readAsDataURL(file);
  });
}

/* ----------------------
   Particles (light)
   ---------------------- */
let particlesRunning = false;
let partCtx, partCanvas, partAnim;
function startParticles(){
  if(particlesRunning) return;
  const c = document.getElementById('particles');
  partCanvas = c; partCtx = c.getContext('2d');
  function resize(){ c.width = innerWidth; c.height = innerHeight; }
  resize(); window.addEventListener('resize', resize);
  const particles = [];
  for(let i=0;i<60;i++){
    particles.push({
      x: Math.random()*c.width,
      y: Math.random()*c.height,
      vx: (Math.random()-0.5)*0.4,
      vy: (Math.random()-0.5)*0.4,
      r: 1 + Math.random()*2,
      a: 0.15 + Math.random()*0.4
    });
  }
  function loop(){
    partCtx.clearRect(0,0,c.width,c.height);
    for(const p of particles){
      p.x += p.vx; p.y += p.vy;
      if(p.x<0)p.x=c.width; if(p.x>c.width)p.x=0;
      if(p.y<0)p.y=c.height; if(p.y>c.height)p.y=0;
      partCtx.beginPath();
      partCtx.fillStyle = 'rgba(139,92,246,'+p.a+')';
      partCtx.arc(p.x,p.y,p.r,0,Math.PI*2);
      partCtx.fill();
    }
    partAnim = requestAnimationFrame(loop);
  }
  particlesRunning = true; loop();
}

function stopParticles(){
  if(!particlesRunning) return;
  cancelAnimationFrame(partAnim);
  const c = document.getElementById('particles');
  const ctx = c.getContext('2d');
  ctx.clearRect(0,0,c.width,c.height);
  particlesRunning = false;
}

/* ----------------------
   Misc UI interactions
   ---------------------- */

document.addEventListener('DOMContentLoaded', ()=>{
  // initial render
  renderAll();

  // load login state from session
  if(sessionStorage.getItem('nw_authed')==='1'){
    isLogged = true;
    document.querySelectorAll('.edit-badge').forEach(b=>b.style.display='inline-block');
  }

  // hamburger behavior
  const ham = document.getElementById('hambtn'), menu = document.getElementById('main-menu');
  ham.addEventListener('click', ()=>{
    const expanded = ham.getAttribute('aria-expanded') === 'true';
    ham.setAttribute('aria-expanded', String(!expanded));
    if(menu.style.display==='flex' || menu.style.display==='block'){ menu.style.display='none'; }
    else { menu.style.display='flex'; menu.style.flexDirection='row'; }
  });

  // admin open
  document.getElementById('open-admin').addEventListener('click', openAdminModal);
  document.getElementById('close-admin-top').addEventListener('click', closeAdminModal);
  document.getElementById('login-cancel').addEventListener('click', closeAdminModal);

  // support direct ?panel=1 param (but block if not logged)
  const params = new URLSearchParams(location.search);
  if(params.get('panel') === '1'){
    if(sessionStorage.getItem('nw_authed')==='1'){
      isLogged = true; openAdminModal();
    } else {
      alert('Acesso ao painel bloqueado: autenticação necessária.');
    }
  }

  // login form submit
  document.getElementById('login-btn').addEventListener('click', ()=>{
    const u = document.getElementById('adm-user').value.trim();
    const p = document.getElementById('adm-pass').value;
    const ok = tryLogin(u,p);
    if(ok){
      // small delay then show editor
      setTimeout(()=>{ showEditor(); fillEditorWithState(); attachEditorEvents(); },80);
    }
  });

  // keyboard: ESC to close modal
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape'){
      // close admin modal if open
      if(document.getElementById('admin-modal').style.display === 'block') closeAdminModal();
    }
  });

  // poster fallback: if SITE.posterData empty, generate svg; else already set
  if(!SITE.posterData){
    document.getElementById('poster').src = makePosterSVG(SITE.title, SITE.subtitle);
  }

  // if logged, attach editor events early
  if(isLogged) attachEditorEvents();

  // small accessibility for menu: allow Enter on hamburger
  ham.addEventListener('keypress', (e)=>{ if(e.key === 'Enter') ham.click(); });

  // if open admin after DOM ready
  // show editor badges if logged
  if(isLogged) document.querySelectorAll('.edit-badge').forEach(b=>b.style.display='inline-block');

  // try to persist render when localStorage updated elsewhere
  window.addEventListener('storage', (e)=>{
    if(e.key === STORAGE_KEY){
      SITE = loadState();
      renderAll();
    }
  });
});

/* on save from editor (button) already saves to localStorage; but we auto-save periodically */
setInterval(()=>{ saveState(SITE); }, 60000); // auto-save a cada 60s

/* ----------------------
   Small security guard: prevent edit if trying to access via special url param
   ---------------------- */
/* If user tries to go /?panel=1 and not authed, show message in console
   NOTE: Authentication here is client-side and not secure — see README. */

/* ======================
   End of JS
   ====================== */
</script>

</body>
</html>
